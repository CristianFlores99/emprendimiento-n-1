<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini-ERP Plantas â€” SPA</title>
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--accent:#2f855a;--muted:#6b7280;--glass:rgba(255,255,255,0.7)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#eef7ef, #f6f7f9);color:#0f172a}
    header{background:var(--card);display:flex;align-items:center;justify-content:space-between;padding:12px 18px;box-shadow:0 1px 4px rgba(2,6,23,0.06);position:sticky;top:0;z-index:10}
    header h1{font-size:18px;margin:0;color:var(--accent)}
    .layout{display:grid;grid-template-columns:260px 1fr 360px;gap:18px;padding:18px;max-width:1400px;margin:18px auto}
    nav{background:var(--card);border-radius:12px;padding:12px;height:calc(100vh - 120px);overflow:auto}
    main{background:transparent}
    aside{background:var(--card);border-radius:12px;padding:12px;height:calc(100vh - 120px);overflow:auto}
    .menu-btn{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
    .menu-btn:hover{background:#f0fdf4}
    .search{display:flex;gap:8px;margin-bottom:12px}
    .search input{flex:1;padding:8px;border-radius:8px;border:1px solid #e6edf3}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .chip{padding:6px 8px;border-radius:999px;border:1px dashed #e5e7eb;font-size:13px;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
    .card{background:var(--card);border-radius:12px;padding:10px;box-shadow:0 6px 16px rgba(15,23,42,0.04)}
    .thumb{height:110px;border-radius:10px;background-size:cover;background-position:center;margin-bottom:8px}
    .title{font-weight:600;font-size:14px}
    .muted{color:var(--muted);font-size:13px}
    .btn{display:inline-block;padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #e6edf3;color:var(--accent)}
    .small{padding:6px 8px;font-size:13px}
    .row{display:flex;gap:8px;align-items:center}
    form .row{margin-bottom:8px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf3}
    .section{margin-bottom:12px}
    .divider{height:1px;background:#eef2f7;margin:12px 0}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-bottom:1px solid #f3f4f6}
    .badge{background:#f0fdf4;color:#065f46;padding:6px 8px;border-radius:999px;font-size:12px}
    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}
    /* responsive */
    @media(max-width:1000px){.layout{grid-template-columns:1fr;padding:12px}.aside-hide{display:none}.nav-collapse{display:flex;overflow:auto;height:auto}}
  </style>
</head>
<body>
  <header>
    <h1>ðŸŒ¿ Mini-ERP Plantas</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="muted">Usuario: Vendedor</div>
      <button class="btn small" id="btn-reset">Reset datos</button>
    </div>
  </header>

  <div class="layout">
    <nav>
      <div class="search"><input id="q" placeholder="Buscar por nombre, etiqueta..."><button class="btn" id="btn-search">Buscar</button></div>
      <div class="section">
        <div class="menu-btn" id="m-inv">ðŸ“š CatÃ¡logo</div>
        <div class="menu-btn" id="m-add">âž• Nuevo producto</div>
        <div class="menu-btn" id="m-ventas">ðŸ§¾ Ventas</div>
        <div class="menu-btn" id="m-demand">ðŸ“¥ Consultas / Demanda</div>
        <div class="menu-btn" id="m-provs">ðŸšš Proveedores</div>
        <div class="menu-btn" id="m-reports">ðŸ“Š Reportes</div>
        <!-- BotÃ³n del menÃº lateral -->
        <li id="m-macetas">ðŸª´ Macetas</li>
      </div>

      <div class="divider"></div>

      <div class="section">
        <strong>Filtros rÃ¡pidos</strong>
        <div class="filters" id="filters"></div>
        <div style="margin-top:8px">
          <label>Tipo</label>
          <select id="filter-type"><option value="">Todos</option><option>Interior</option><option>Exterior</option><option>Ambos</option></select>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section">
        <strong>Carrito</strong>
        <div id="cart-list"></div>
        <div style="margin-top:8px" class="row"><button class="btn" id="btn-checkout">Cobrar</button><button class="btn btn-ghost small" id="btn-clear-cart">Limpiar</button></div>
      </div>
    </nav>

    <main>
      <div id="view-root"></div>
    </main>

    <aside class="aside-hide">
      <div class="card" style="margin-bottom:12px">
        <h3 style="margin-top:0">Ficha rÃ¡pida</h3>
        <div id="quick-ficha">Selecciona una planta</div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Consultas recientes</h3>
        <div id="demand-list"></div>
      </div>
    </aside>
  </div>

  <footer>Hecho para prototipo â€” datos guardados en localStorage</footer>

  <script>
    /* ------------------ MODELO (localStorage) ------------------ */
    const STORAGE_KEY = 'mini_erp_plantas_v1'

    function seedData(){
      const sample = {
        products: [
          {id:1,name:'Monstera Deliciosa',scientific:'Monstera deliciosa',type:'Interior',light:'Media sombra',water:'Moderado',size:'M',price:4500,qty:5,tags:['colgante','hojas grandes'],img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=800&q=60'},
          {id:2,name:'Pothos (Epipremnum)',scientific:'Epipremnum aureum',type:'Interior',light:'Media sombra',water:'Poco',size:'S',price:2200,qty:12,tags:['colgante','fÃ¡cil'],img:'https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=800&q=60'},
          {id:3,name:'Cactus Echinopsis',scientific:'Echinopsis spp',type:'Exterior',light:'Sol directo',water:'Poco',size:'S',price:1500,qty:8,tags:['cactus','suculenta'],img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=800&q=60'},
          {id:4,name:'Areca Palm',scientific:'Dypsis lutescens',type:'Ambos',light:'Sol indirecto',water:'Moderado',size:'L',price:7800,qty:2,tags:['palmera'],img:'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=800&q=60'}
        ],
        demands: [
          {id:1,query:'Monstera variegata',contact:'',date:new Date().toISOString(),status:'pendiente',notes:'PreguntÃ³ si la van a traer'},
        ],
        providers:[{id:1,name:'Vivero Central',contact:'vivero@ejemplo.com'},{id:2,name:'Distribuidora Verde',contact:'ventas@verde.com'}],
        sales:[]
      }
      localStorage.setItem(STORAGE_KEY,JSON.stringify(sample))
      return sample
    }

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY)
      return raw ? JSON.parse(raw) : seedData()
    }
    function save(state){localStorage.setItem(STORAGE_KEY,JSON.stringify(state))}

    let state = load()

    /* ---------- UTILIDADES ---------- */
    function el(tag, attrs={}, ...children){const n=document.createElement(tag);for(let k in attrs){if(k.startsWith('@')) n.addEventListener(k.slice(1),attrs[k]); else if(k==='html') n.innerHTML=attrs[k]; else n.setAttribute(k,attrs[k])}children.forEach(c=>{if(typeof c==='string') n.appendChild(document.createTextNode(c)); else if(c) n.appendChild(c)});return n}
    function uid(){return Date.now()+Math.floor(Math.random()*999)}

    /* ---------- RENDER VIEWS ---------- */
    const root = document.getElementById('view-root')
    const qInput = document.getElementById('q')
    const filtersDiv = document.getElementById('filters')

    function renderCatalog(filterText=''){
      root.innerHTML=''
      const header = el('div',{class:'row',style:'justify-content:space-between;align-items:center;margin-bottom:8px'},
        el('h2',{},'CatÃ¡logo â€” Productos'),
        el('div',{},el('button',{class:'btn','@click':()=>renderAddProduct()},'âž• Crear producto'))
      )
      root.appendChild(header)

      const grid = el('div',{class:'grid'})
      const list = state.products.filter(p=>{
        const q=filterText.trim().toLowerCase()
        if(!q) return true
        return p.name.toLowerCase().includes(q) || (p.tags||[]).join(' ').toLowerCase().includes(q) || (p.scientific||'').toLowerCase().includes(q)
      })
      list.forEach(p=>{
        const card = el('div',{class:'card'},
          el('div',{class:'thumb',style:`background-image:url(${p.img})`} ),
          el('div',{class:'title'},p.name),
          el('div',{class:'muted'},p.scientific||''),
          el('div',{class:'row',style:'margin-top:6px;justify-content:space-between'},
            el('div',{},el('div',{},el('span',{},'â‚± '+p.price)),el('div',{class:'muted'},p.qty+' disponibles')),
            el('div',{},
              el('button',{class:'btn small','@click':()=>openProduct(p.id)},'Ver'),
              el('button',{class:'btn btn-ghost small','@click':()=>addToCart(p.id)},'AÃ±adir')
            )
          )
        )
        grid.appendChild(card)
      })

      root.appendChild(grid)
    }

    function openProduct(id){
      const p = state.products.find(x=>x.id==id)
      if(!p) return
      // Quick ficha right panel
      document.getElementById('quick-ficha').innerHTML = `
        <div style="background-image:url(${p.img});height:120px;background-size:cover;border-radius:8px"></div>
        <h3 style="margin:8px 0 4px">${p.name}</h3>
        <div class="muted">${p.scientific||''}</div>
        <div style="margin-top:8px">Tipo: <strong>${p.type}</strong></div>
        <div>Luz: ${p.light}</div>
        <div>Riego: ${p.water}</div>
        <div>TamaÃ±o: ${p.size}</div>
        <div style="margin-top:8px">Precio: <strong>â‚± ${p.price}</strong></div>
        <div style="margin-top:8px">Stock: <span class="badge">${p.qty}</span></div>
      `

      // Main view: product detail
      root.innerHTML=''
      const card = el('div',{class:'card'},
        el('div',{style:'display:flex;gap:12px;align-items:flex-start'},
          el('div',{style:'flex:1'},el('div',{style:`background-image:url(${p.img});height:280px;background-size:cover;border-radius:10px;margin-bottom:8px`}),
            el('div',{},el('button',{class:'btn','@click':()=>addToCart(p.id)},'AÃ±adir al carrito'))
          ),
          el('div',{style:'width:340px'},
            el('h2',{},p.name),
            el('div',{class:'muted'},p.scientific||''),
            el('div',{style:'margin-top:8px'},el('strong',{},'Ficha tÃ©cnica')),
            el('div',{},`Tipo: ${p.type}`),
            el('div',{},`Luz: ${p.light}`),
            el('div',{},`Riego: ${p.water}`),
            el('div',{},`TamaÃ±o: ${p.size}`),
            el('div',{},`Etiquetas: ${(p.tags||[]).join(', ')}`),
            el('div',{class:'section',style:'margin-top:8px'},
              el('button',{class:'btn','@click':()=>renderEditProduct(p.id)},'Editar'),
              el('button',{class:'btn btn-ghost small','@click':()=>askDemand(p.name)},'Registrar demanda')
            )
          )
        )
      )
      root.appendChild(card)
    }

    function renderAddProduct(){
      root.innerHTML=''
      root.appendChild(el('h2',{},'Crear producto'))
      const form = el('form',{},
        el('div',{class:'row'},
          el('div',{style:'flex:1'},el('label',{},'Nombre'),el('input',{id:'f-name'})),
          el('div',{style:'width:140px'},el('label',{},'Precio'),el('input',{id:'f-price',type:'number'}))
        ),
        el('div',{class:'row'},
          el('div',{style:'flex:1'},el('label',{},'Nombre cientÃ­fico'),el('input',{id:'f-science'})),
          el('div',{style:'width:140px'},el('label',{},'Cantidad'),el('input',{id:'f-qty',type:'number',value:1}))
        ),
        el('div',{class:'row'},
          el('div',{style:'flex:1'},el('label',{},'Tipo'),el('select',{id:'f-type'},el('option',{},''),el('option',{},'Interior'),el('option',{},'Exterior'),el('option',{},'Ambos'))),
          el('div',{style:'width:160px'},el('label',{},'TamaÃ±o'),el('select',{id:'f-size'},el('option',{},'S'),el('option',{},'M'),el('option',{},'L')))
        ),
        el('label',{},'Luz'),el('input',{id:'f-light'}),
        el('label',{},'Riego'),el('input',{id:'f-water'}),
        el('label',{},'Etiquetas (separadas por coma)'),el('input',{id:'f-tags'}),
        el('label',{},'URL imagen'),el('input',{id:'f-img'}),
        el('div',{style:'margin-top:8px'},el('button',{class:'btn','@click':onCreate},'Guardar'))
      )
      root.appendChild(form)

      function onCreate(e){
        e.preventDefault()
        const p = {
          id: uid(),
          name: document.getElementById('f-name').value || 'Sin nombre',
          scientific: document.getElementById('f-science').value,
          price: Number(document.getElementById('f-price').value)||0,
          qty: Number(document.getElementById('f-qty').value)||0,
          type: document.getElementById('f-type').value,
          size: document.getElementById('f-size').value,
          light: document.getElementById('f-light').value,
          water: document.getElementById('f-water').value,
          tags: (document.getElementById('f-tags').value||'').split(',').map(s=>s.trim()).filter(Boolean),
          img: document.getElementById('f-img').value || 'https://images.unsplash.com/photo-1523413651479-597eb2da0ad6?auto=format&fit=crop&w=800&q=60'
        }
        state.products.push(p)
        save(state)
        renderCatalog()
      }
    }

    function renderEditProduct(id){
      const p = state.products.find(x=>x.id==id)
      if(!p) return
      root.innerHTML=''
      root.appendChild(el('h2',{},'Editar producto'))
      const form = el('form',{},
        el('label',{},'Nombre'),el('input',{id:'e-name',value:p.name}),
        el('label',{},'Precio'),el('input',{id:'e-price',type:'number',value:p.price}),
        el('label',{},'Cantidad'),el('input',{id:'e-qty',type:'number',value:p.qty}),
        el('label',{},'Tipo'),el('select',{id:'e-type'},el('option',{},''),el('option',{},'Interior'),el('option',{},'Exterior'),el('option',{},'Ambos')),
        el('label',{},'Luz'),el('input',{id:'e-light',value:p.light}),
        el('label',{},'Riego'),el('input',{id:'e-water',value:p.water}),
        el('label',{},'Etiquetas'),el('input',{id:'e-tags',value:(p.tags||[]).join(', ')}),
        el('label',{},'URL imagen'),el('input',{id:'e-img',value:p.img}),
        el('div',{style:'margin-top:8px'},el('button',{class:'btn','@click':onSave},'Guardar cambios'),el('button',{class:'btn btn-ghost small','@click':onDelete},'Eliminar'))
      )
      root.appendChild(form)

      // set select
      setTimeout(()=>{document.getElementById('e-type').value = p.type},0)

      function onSave(e){e.preventDefault();p.name=document.getElementById('e-name').value;p.price=Number(document.getElementById('e-price').value);p.qty=Number(document.getElementById('e-qty').value);p.type=document.getElementById('e-type').value;p.light=document.getElementById('e-light').value;p.water=document.getElementById('e-water').value;p.tags=(document.getElementById('e-tags').value||'').split(',').map(s=>s.trim()).filter(Boolean);p.img=document.getElementById('e-img').value;save(state);renderCatalog()}
      function onDelete(e){e.preventDefault();if(!confirm('Eliminar producto?')) return;state.products = state.products.filter(x=>x.id!=p.id);save(state);renderCatalog()}
    }

    /* ---------- CART y VENTAS ---------- */
    let cart = []
    function addToCart(id){
      const p = state.products.find(x=>x.id==id)
      if(!p) return alert('Producto no encontrado')
      if(p.qty<=0) return alert('Sin stock')
      const item = cart.find(i=>i.id==id)
      if(item) item.qty++
      else cart.push({id:p.id,name:p.name,price:p.price,qty:1})
      renderCart()
    }
    function renderCart(){
      const c = document.getElementById('cart-list')
      c.innerHTML=''
      if(cart.length===0){c.appendChild(el('div',{},'Carrito vacÃ­o')) ; return}
      cart.forEach(i=>{
        const row = el('div',{class:'row',style:'justify-content:space-between;align-items:center;margin-bottom:6px'},
          el('div',{},`${i.name} x${i.qty}`),
          el('div',{},el('button',{class:'btn btn-ghost small','@click':()=>decrease(i.id)},'-'),el('button',{class:'btn small','@click':()=>increase(i.id)},'+'))
        )
        c.appendChild(row)
      })
      function increase(id){const it=cart.find(x=>x.id==id);it.qty++;renderCart()}
      function decrease(id){const it=cart.find(x=>x.id==id);it.qty--; if(it.qty<=0) cart=cart.filter(x=>x.id!=id); renderCart()}
    }

    document.getElementById('btn-clear-cart').addEventListener('click',()=>{cart=[];renderCart()})
    document.getElementById('btn-checkout').addEventListener('click',()=>{
      if(cart.length===0) return alert('Carrito vacÃ­o')
      // apply sale
      const saleItems = cart.map(i=>({id:i.id,qty:i.qty,price:i.price}))
      // check stock
      for(const it of saleItems){const p = state.products.find(x=>x.id==it.id); if(!p || p.qty < it.qty) return alert('Stock insuficiente para '+(p? p.name:''))}
      // decrement
      for(const it of saleItems){const p = state.products.find(x=>x.id==it.id); p.qty -= it.qty}
      const total = saleItems.reduce((s,i)=>s + i.qty*i.price,0)
      state.sales.push({id:uid(),date:new Date().toISOString(),items:saleItems,total})
      save(state)
      cart=[]
      renderCart(); renderCatalog(); alert('Venta registrada. Total: â‚± '+total)
    })

    /* ---------- DEMANDAS / CONSULTAS ---------- */
    function askDemand(name=''){
      const contact = prompt('Contacto (opcional)')
      const notes = prompt('Notas / descripciÃ³n (opcional)')
      const d = {id:uid(),query:name||prompt('Â¿QuÃ© planta?'),contact:contact||'',date:new Date().toISOString(),status:'pendiente',notes:notes||''}
      state.demands.push(d); save(state); renderDemands()
      alert('Demanda registrada')
    }

    function renderDemands(){
      const elD = document.getElementById('demand-list')
      if(!elD) return
      elD.innerHTML=''
      state.demands.slice().reverse().forEach(d=>{
        const row = el('div',{},el('div',{},el('strong',{},d.query)),el('div',{class:'muted'},new Date(d.date).toLocaleString()),el('div',{},el('button',{class:'btn small','@click':()=>markDone(d.id)},d.status)))
        elD.appendChild(row)
      })
    }
    function markDone(id){const d=state.demands.find(x=>x.id==id); if(!d) return; d.status = prompt('Estado (pendiente/confirmada/no disponible)',d.status)||d.status; save(state); renderDemands()}

    /* ---------- PROVEEDORES ---------- */
    function renderProviders(){
      root.innerHTML=''
      root.appendChild(el('h2',{},'Proveedores'))
      const card = el('div',{class:'card'},
        el('table',{},el('thead',{},el('tr',{},el('th',{},'ID'),el('th',{},'Nombre'),el('th',{},'Contacto'))),el('tbody',{},...state.providers.map(p=>el('tr',{},el('td',{},p.id),el('td',{},p.name),el('td',{},p.contact)))))
      )
      root.appendChild(card)
    }

    /* ---------- REPORTES ---------- */
    function renderReports(){
      const topSold = {}
      state.sales.forEach(s=>s.items.forEach(i=>{topSold[i.id] = (topSold[i.id]||0) + i.qty}))
      const top = Object.entries(topSold).map(([id,qty])=>({product: state.products.find(p=>p.id==id)?.name||'--',qty})).sort((a,b)=>b.qty-a.qty).slice(0,8)

      root.innerHTML=''
      root.appendChild(el('h2',{},'Reportes'))
      const card = el('div',{class:'card'},
        el('h3',{},'Top productos vendidos'),
        el('ul',{},...top.map(t=>el('li',{},`${t.product} â€” ${t.qty} uds`))),
        el('div',{class:'divider'}),
        el('h3',{},'Productos con stock bajo'),
        el('ul',{},...state.products.filter(p=>p.qty<=3).map(p=>el('li',{},`${p.name} â€” ${p.qty} uds`)))
      )
      root.appendChild(card)
    }

    /* ---------- SMALL UI wiring ---------- */
    document.getElementById('m-inv').addEventListener('click',()=>renderCatalog(qInput.value))
    document.getElementById('m-add').addEventListener('click',()=>renderAddProduct())
    document.getElementById('m-ventas').addEventListener('click',()=>{root.innerHTML=''; root.appendChild(el('h2',{},'Ventas')); root.appendChild(el('div',{},el('pre',{},JSON.stringify(state.sales.slice().reverse(),null,2))))})
document.getElementById('m-demand').addEventListener('click', () => {
  root.innerHTML = '';
  root.appendChild(el('h2', {}, 'Consultas / Demanda'));

  // BotÃ³n para registrar nueva demanda
  root.appendChild(
    el('button', { class: 'btn', onclick: () => askDemand('') }, 'Registrar demanda manual')
  );

  // Tabla de demandas
  const t = el('table', {});
  const thead = el('thead', {},
    el('tr', {},
      el('th', {}, 'Fecha'),
      el('th', {}, 'Consulta'),
      el('th', {}, 'Contacto'),
      el('th', {}, 'Estado')
    )
  );

  const tbody = el('tbody', {},
    ...state.demands.map(d => el('tr', {},
      el('td', {}, new Date(d.date).toLocaleDateString()),
      el('td', {}, d.query),
      el('td', {}, d.contact),
      el('td', {}, d.status)
    ))
  );

  t.appendChild(thead);
  t.appendChild(tbody);
  root.appendChild(t);
});
    document.getElementById('m-provs').addEventListener('click',()=>renderProviders())
    document.getElementById('m-reports').addEventListener('click',()=>renderReports())

    document.getElementById('btn-search').addEventListener('click',()=>renderCatalog(qInput.value))
    document.getElementById('q').addEventListener('keydown',(e)=>{if(e.key==='Enter') renderCatalog(qInput.value)})

    document.getElementById('btn-reset').addEventListener('click',()=>{if(confirm('Resetear datos de ejemplo?')){seedData();state = load(); renderCatalog(); renderDemands(); renderCart(); alert('Datos reseteados')}})

    // filters chips
    const chips = ['colgante','fÃ¡cil','cactus','palmera']
    chips.forEach(c=>{const chip = el('div',{class:'chip','@click':()=>{qInput.value=c;renderCatalog(c)}},c);filtersDiv.appendChild(chip)})

    // initial render
    renderCatalog()
    renderDemands()
    renderCart()

  </script>
</body>
</html>